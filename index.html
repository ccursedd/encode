<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>kittybin.lat</title>

<script src="https://cdn.tailwindcss.com"></script>
<script>
tailwind.config = {
  theme: {
    extend: {
      fontFamily: { sans: ['Inter','ui-sans-serif','system-ui'] },
      colors: { accent: '#8b5cf6' }
    }
  }
}
</script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');

body {
  background: radial-gradient(circle at top, #111827 0%, #000000 65%);
}

.glass {
  background: rgba(17,24,39,.6);
  backdrop-filter: blur(16px);
  border: 1px solid rgba(255,255,255,.06);
}

.card { border-radius: 1.25rem; box-shadow: 0 20px 50px rgba(0,0,0,.4); }

.btn { padding:.6rem 1.2rem; border-radius:.75rem; font-weight:500; transition:.2s; }
.btn-primary { background:#8b5cf6; color:white; }
.btn-primary:hover{filter:brightness(110%);}
.btn-secondary{background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.1);}
.btn-secondary:hover{background:rgba(255,255,255,.1);}

.input {
  width:100%;
  background:rgba(255,255,255,.05);
  border:1px solid rgba(255,255,255,.1);
  border-radius:.75rem;
  padding:.6rem 1rem;
}
.input:focus{
  outline:none;
  border-color:#8b5cf6;
  box-shadow:0 0 0 2px rgba(139,92,246,.3);
}

.table-row{
  border-bottom:1px solid rgba(255,255,255,.05);
}
.table-row:hover{background:rgba(255,255,255,.05);}

.toast{
  background:rgba(17,24,39,.9);
  backdrop-filter:blur(10px);
  border:1px solid rgba(255,255,255,.1);
  padding:.75rem 1rem;
  border-radius:.75rem;
  font-size:.875rem;
  box-shadow:0 10px 30px rgba(0,0,0,.4);
}
</style>
</head>

<body class="text-gray-200 font-sans min-h-screen flex flex-col">

<nav class="glass sticky top-0 z-50">
<div class="max-w-7xl mx-auto px-6 h-16 flex items-center justify-between">
<a href="#/" class="text-xl font-extrabold tracking-tight">
kittybin<span class="text-accent">.lat</span>
</a>
<div class="hidden md:flex items-center gap-6 text-sm">
<a href="#/">Home</a>
<a href="#/add">Create</a>
<a href="#/users">Users</a>
<a href="#/about">About</a>
</div>
<div id="authButtons" class="flex gap-3"></div>
</div>
</nav>

<main class="flex-1 max-w-7xl mx-auto px-6 py-12 w-full">
<div id="app"></div>
</main>

<footer class="glass mt-16">
<div class="max-w-7xl mx-auto px-6 py-8 text-center text-sm text-gray-400">
<p class="font-medium text-gray-300">kittybin.lat</p>
<p class="mt-1">Permanent links. Zero nonsense.</p>
<p class="mt-2 text-xs opacity-60">Â© 2026</p>
</div>
</footer>

<div id="toastContainer" class="fixed bottom-6 right-6 space-y-3 z-50"></div>

<script type="module">
import { createClient } from 'https://esm.sh/@supabase/supabase-js@2'
const supabase = createClient(
'https://ylgtgecqhdhakzbjdkqq.supabase.co',
'sb_publishable_ILF6pER_bdL8GppxOzfumg_xsDoMA6T'
)

let currentUser=null

function showToast(msg){
const t=document.createElement('div')
t.className='toast'
t.textContent=msg
document.getElementById('toastContainer').appendChild(t)
setTimeout(()=>t.remove(),3000)
}

function escapeHtml(str){
if(!str) return ''
return str.replace(/&/g,"&amp;")
.replace(/</g,"&lt;")
.replace(/>/g,"&gt;")
}

function navigate(p){ window.location.hash='#'+p }
function route(){ handleRoute() }
window.addEventListener('hashchange',route)

async function initAuth(){
const {data:{session}}=await supabase.auth.getSession()
if(session){ currentUser=session.user }
updateAuth()
handleRoute()
}

function updateAuth(){
const div=document.getElementById('authButtons')
if(currentUser){
div.innerHTML=`<button id="logout" class="btn btn-secondary">Logout</button>`
document.getElementById('logout').onclick=async()=>{
await supabase.auth.signOut()
currentUser=null
updateAuth()
navigate('/')
}
}else{
div.innerHTML=`
<a href="#/login" class="btn btn-secondary">Login</a>
<a href="#/signup" class="btn btn-primary">Sign Up</a>`
}
}

async function handleRoute(){
const path=window.location.hash.slice(1)||'/'
if(path==='/') renderHome()
else if(path==='/add') renderAdd()
else if(path.startsWith('/paste/')) renderPaste(path.split('/')[2])
else if(path==='/users') renderUsers()
else if(path.startsWith('/user/')) renderProfile(path.split('/')[2])
else if(path==='/about') renderAbout()
else if(path==='/login') renderLogin()
else if(path==='/signup') renderSignup()
else renderHome()
}

async function renderHome(){
const {data}=await supabase.from('pastes').select('id,title,created_at,views').order('created_at',{ascending:false}).limit(20)
document.getElementById('app').innerHTML=`
<div class="space-y-8">
<div class="card glass p-8 text-center">
<h1 class="text-4xl font-bold mb-4">Share text instantly</h1>
<p class="text-gray-400 mb-6">Permanent links. Clean UI. No nonsense.</p>
<a href="#/add" class="btn btn-primary">Create Paste</a>
</div>

<div class="card glass p-6">
<h2 class="text-xl font-semibold mb-4">Recent Pastes</h2>
<table class="w-full text-sm">
${data?.map(p=>`
<tr class="table-row">
<td class="py-3"><a href="#/paste/${p.id}" class="hover:underline">${escapeHtml(p.title)}</a></td>
<td>${p.views||0} views</td>
</tr>
`).join('')||'<tr><td>No pastes yet</td></tr>'}
</table>
</div>
</div>`
}

async function renderAdd(){
if(!currentUser){ navigate('/login'); return }
document.getElementById('app').innerHTML=`
<div class="max-w-2xl mx-auto card glass p-8">
<h2 class="text-xl font-bold mb-6">Create Paste</h2>
<form id="pasteForm" class="space-y-4">
<input id="title" placeholder="Title" class="input" required>
<textarea id="content" rows="12" class="input font-mono" placeholder="Your content..." required></textarea>
<button class="btn btn-primary">Create</button>
</form>
</div>`
document.getElementById('pasteForm').onsubmit=async e=>{
e.preventDefault()
const title=title.value
const content=content.value
const {data,error}=await supabase.from('pastes').insert([{title,content,user_id:currentUser.id,views:0}]).select().single()
if(error) showToast(error.message)
else navigate('/paste/'+data.id)
}
}

async function renderPaste(id){
const {data}=await supabase.from('pastes').select('*').eq('id',id).single()
if(!data){ showToast('Not found'); navigate('/'); return }
await supabase.from('pastes').update({views:(data.views||0)+1}).eq('id',id)
document.getElementById('app').innerHTML=`
<div class="card glass p-8 space-y-6">
<h1 class="text-2xl font-bold">${escapeHtml(data.title)}</h1>
<p class="text-sm text-gray-400">${(data.views||0)+1} views</p>
<pre class="bg-black/40 border border-white/10 p-6 rounded-xl overflow-x-auto text-sm font-mono whitespace-pre-wrap">${escapeHtml(data.content)}</pre>
</div>`
}

async function renderUsers(){
const {data}=await supabase.from('profiles').select('username')
document.getElementById('app').innerHTML=`
<div class="card glass p-8">
<h2 class="text-xl font-bold mb-6">Users</h2>
<ul class="space-y-2">
${data?.map(u=>`<li><a href="#/user/${u.username}" class="hover:underline">${u.username}</a></li>`).join('')}
</ul>
</div>`
}

async function renderProfile(username){
const {data}=await supabase.from('profiles').select('*').eq('username',username).single()
if(!data){ showToast('User not found'); navigate('/users'); return }
const {data:pastes}=await supabase.from('pastes').select('id,title').eq('user_id',data.id)
document.getElementById('app').innerHTML=`
<div class="space-y-8">
<div class="card glass p-8">
<h1 class="text-2xl font-bold">${data.username}</h1>
</div>
<div class="card glass p-6">
<h2 class="font-semibold mb-4">Pastes</h2>
<ul class="space-y-2">
${pastes?.map(p=>`<li><a href="#/paste/${p.id}" class="hover:underline">${escapeHtml(p.title)}</a></li>`).join('')||'No pastes yet'}
</ul>
</div>
</div>`
}

function renderAbout(){
document.getElementById('app').innerHTML=`
<div class="card glass p-8">
<h1 class="text-2xl font-bold mb-4">About</h1>
<p class="text-gray-400">kittybin.lat is a modern pastebin built with Supabase.</p>
</div>`
}

function renderLogin(){
document.getElementById('app').innerHTML=`
<div class="max-w-md mx-auto card glass p-8">
<h2 class="text-xl font-bold mb-6">Login</h2>
<form id="loginForm" class="space-y-4">
<input id="email" type="email" class="input" placeholder="Email" required>
<input id="password" type="password" class="input" placeholder="Password" required>
<button class="btn btn-primary w-full">Login</button>
</form>
</div>`
document.getElementById('loginForm').onsubmit=async e=>{
e.preventDefault()
const {error}=await supabase.auth.signInWithPassword({email:email.value,password:password.value})
if(error) showToast(error.message)
else initAuth()
}
}

function renderSignup(){
document.getElementById('app').innerHTML=`
<div class="max-w-md mx-auto card glass p-8">
<h2 class="text-xl font-bold mb-6">Sign Up</h2>
<form id="signupForm" class="space-y-4">
<input id="email" type="email" class="input" placeholder="Email" required>
<input id="password" type="password" class="input" placeholder="Password" required>
<button class="btn btn-primary w-full">Sign Up</button>
</form>
</div>`
document.getElementById('signupForm').onsubmit=async e=>{
e.preventDefault()
const {error}=await supabase.auth.signUp({email:email.value,password:password.value})
if(error) showToast(error.message)
else navigate('/login')
}
}

initAuth()
</script>
</body>
</html>
