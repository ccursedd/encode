<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>kittybin.org</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:opsz@14..32&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: #0a0a0a;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, monospace;
            color: #e0e0e0;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: #000000;
            border: 2px solid #333333;
            padding: 20px 25px;
        }

        .top-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 2px solid #333333;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }

        .logo-area {
            display: flex;
            align-items: center;
            gap: 40px;
            width: 100%;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: 700;
            color: #ffffff;
        }

        .nav-links {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
        }

        .nav-links a {
            text-decoration: none;
            color: #cccccc;
            font-weight: 500;
            font-size: 1rem;
            padding: 5px 0;
            cursor: pointer;
        }

        .nav-links a.active {
            color: #ffffff;
            font-weight: 700;
            text-decoration: underline;
        }

        .nav-links a:hover {
            color: #ffffff;
        }

        .user-status {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .username-display {
            color: #00ff00;
            font-weight: 600;
        }

        .logout-btn {
            background: #1a1a1a;
            color: #ff6666;
            border: 2px solid #444;
            padding: 5px 15px;
            cursor: pointer;
            font-weight: 600;
        }

        .logout-btn:hover {
            background: #222;
        }

        .search-section {
            margin-bottom: 20px;
        }

        .search-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #333333;
            background: #111111;
            font-size: 1rem;
            color: #ffffff;
        }

        .search-input:focus {
            outline: none;
            border-color: #666666;
        }

        .pastes-header {
            font-size: 1rem;
            margin-bottom: 20px;
            color: #aaaaaa;
            border-left: 4px solid #444;
            padding-left: 10px;
        }

        .section-card {
            border: 2px solid #333333;
            margin-bottom: 30px;
            background: #0a0a0a;
        }

        .section-header {
            background: #1a1a1a;
            color: #ffffff;
            padding: 10px 15px;
            font-weight: 700;
            font-size: 1rem;
            border-bottom: 2px solid #333333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .paste-table, .user-table {
            width: 100%;
            border-collapse: collapse;
        }

        .paste-table th, .user-table th {
            text-align: left;
            padding: 15px 10px 8px 10px;
            font-weight: 600;
            font-size: 0.85rem;
            border-bottom: 2px solid #333333;
            color: #aaaaaa;
        }

        .paste-table td, .user-table td {
            padding: 12px 10px;
            border-bottom: 1px solid #222222;
            font-size: 0.9rem;
            color: #dddddd;
        }

        .views {
            background: #1a1a1a;
            padding: 3px 10px;
            border: 1px solid #333;
            color: #ffffff;
        }

        .user-badge {
            color: #888888;
            margin-left: 5px;
            font-style: italic;
        }

        .create-paste {
            border: 2px solid #333333;
            padding: 25px;
            margin-bottom: 30px;
            background: #0a0a0a;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #cccccc;
            font-weight: 600;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #333333;
            background: #111111;
            color: #ffffff;
            font-family: inherit;
        }

        .form-group textarea {
            min-height: 200px;
            resize: vertical;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #666666;
        }

        .create-btn {
            background: #00aa00;
            color: white;
            border: 2px solid #00ff00;
            padding: 12px 30px;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
        }

        .create-btn:hover {
            background: #00cc00;
        }

        .cancel-btn {
            background: #333;
            color: white;
            border: 2px solid #666;
            padding: 12px 30px;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            margin-left: 10px;
        }

        .cancel-btn:hover {
            background: #444;
        }

        .auth-container {
            display: flex;
            justify-content: center;
            margin: 40px 0;
        }

        .auth-box {
            width: 450px;
            border: 2px solid #333333;
            background: #0a0a0a;
        }

        .auth-header {
            background: #1a1a1a;
            color: #ffffff;
            padding: 15px 20px;
            font-weight: 700;
            font-size: 1.3rem;
            border-bottom: 2px solid #333333;
        }

        .auth-form {
            padding: 25px;
        }

        .auth-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #333333;
            background: #111111;
            color: #ffffff;
            margin-top: 5px;
        }

        .auth-btn {
            width: 100%;
            padding: 14px;
            background: #1a1a1a;
            color: #ffffff;
            border: 2px solid #444444;
            font-weight: 700;
            cursor: pointer;
            margin-top: 10px;
        }

        .auth-btn:hover {
            background: #222222;
        }

        .auth-switch {
            margin-top: 20px;
            text-align: center;
            color: #888;
        }

        .auth-switch a {
            color: #ffffff;
            font-weight: 700;
            cursor: pointer;
            margin-left: 5px;
        }

        .error-message {
            color: #ff6666;
            margin-top: 10px;
            text-align: center;
        }

        .success-message {
            color: #00ff00;
            margin-top: 10px;
            text-align: center;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        .no-data {
            padding: 30px;
            text-align: center;
            color: #666;
            border: 2px dashed #333;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="top-bar">
        <div class="logo-area">
            <div class="logo">kittybin.org</div>
            <div class="nav-links">
                <a onclick="showPage('index')" id="nav-index" class="active">Add Paste</a>
                <a onclick="showPage('users')" id="nav-users">Users</a>
                <a onclick="showPage('login')" id="nav-login">Login</a>
                <a onclick="showPage('signup')" id="nav-signup">Sign Up</a>
            </div>
        </div>
        <div class="user-status" id="userStatus" style="display: none;">
            <span class="username-display" id="currentUsername"></span>
            <button class="logout-btn" onclick="logout()">Logout</button>
        </div>
    </div>

    <div class="search-section">
        <input type="text" placeholder="Search pastes..." class="search-input" id="global-search" oninput="filterPastes()">
    </div>
    
    <!-- INDEX PAGE -->
    <div id="page-index" class="page active">
        <div class="section-header">
            <span>Create New Paste</span>
            <span id="pasteCount">0 total pastes</span>
        </div>
        
        <div class="create-paste">
            <div class="form-group">
                <label>Title</label>
                <input type="text" id="pasteTitle" placeholder="Enter paste title" maxlength="100">
            </div>
            <div class="form-group">
                <label>Content</label>
                <textarea id="pasteContent" placeholder="Enter your paste content here..."></textarea>
            </div>
            <div>
                <button class="create-btn" onclick="createPaste()"><i class="fas fa-save"></i> Save Paste</button>
                <button class="cancel-btn" onclick="clearPasteForm()">Clear</button>
            </div>
        </div>

        <div class="section-header">Recent Pastes</div>
        <div class="section-card" id="pastesContainer">
            <table class="paste-table" id="pastesTable">
                <thead>
                    <tr>
                        <th>Title</th>
                        <th>Views</th>
                        <th>Created by</th>
                        <th>Added</th>
                    </tr>
                </thead>
                <tbody id="pastesTableBody">
                    <tr>
                        <td colspan="4" class="no-data">No pastes yet. Be the first to create one!</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- USERS PAGE -->
    <div id="page-users" class="page">
        <div class="pastes-header">
            <i class="fas fa-users"></i> Registered Users
        </div>

        <div class="section-card">
            <table class="user-table" id="usersTable">
                <thead>
                    <tr>
                        <th>Username</th>
                        <th>Role</th>
                        <th>Pastes</th>
                        <th>Joined</th>
                    </tr>
                </thead>
                <tbody id="usersTableBody">
                    <tr>
                        <td colspan="4" class="no-data">No users registered yet. Sign up to be the first!</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- LOGIN PAGE -->
    <div id="page-login" class="page">
        <div class="auth-container">
            <div class="auth-box">
                <div class="auth-header">Login</div>
                <div class="auth-form">
                    <div class="form-group">
                        <label>Username</label>
                        <input type="text" id="loginUsername" class="auth-input">
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="loginPassword" class="auth-input">
                    </div>
                    <button class="auth-btn" onclick="login()">Login</button>
                    <div class="auth-switch">
                        Don't have an account? <a onclick="showPage('signup')">Sign Up</a>
                    </div>
                    <div id="loginError" class="error-message"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- SIGNUP PAGE -->
    <div id="page-signup" class="page">
        <div class="auth-container">
            <div class="auth-box">
                <div class="auth-header">Sign Up</div>
                <div class="auth-form">
                    <div class="form-group">
                        <label>Username</label>
                        <input type="text" id="signupUsername" class="auth-input">
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="signupPassword" class="auth-input">
                    </div>
                    <div class="form-group">
                        <label>Confirm Password</label>
                        <input type="password" id="signupConfirmPassword" class="auth-input">
                    </div>
                    <button class="auth-btn" onclick="signup()">Create Account</button>
                    <div class="auth-switch">
                        Already have an account? <a onclick="showPage('login')">Login</a>
                    </div>
                    <div id="signupError" class="error-message"></div>
                    <div id="signupSuccess" class="success-message"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // ========== RESET EVERYTHING - START FRESH ==========
    // Clear any existing data to ensure no default pastes show up
    localStorage.removeItem('kittybin_users');
    localStorage.removeItem('kittybin_pastes');
    localStorage.removeItem('kittybin_currentUser');
    
    // Start with COMPLETELY EMPTY arrays
    let users = [];
    let pastes = [];
    let currentUser = null;

    // ========== STORAGE FUNCTIONS ==========
    function saveUsers() {
        localStorage.setItem('kittybin_users', JSON.stringify(users));
    }

    function savePastes() {
        localStorage.setItem('kittybin_pastes', JSON.stringify(pastes));
    }

    // Save initial empty state
    saveUsers();
    savePastes();

    // ========== UI UPDATE FUNCTIONS ==========
    function updateUserStatus() {
        const userStatus = document.getElementById('userStatus');
        const currentUsername = document.getElementById('currentUsername');
        
        if (currentUser) {
            userStatus.style.display = 'flex';
            currentUsername.textContent = currentUser.username;
            document.getElementById('nav-login').style.display = 'none';
            document.getElementById('nav-signup').style.display = 'none';
        } else {
            userStatus.style.display = 'none';
            document.getElementById('nav-login').style.display = 'inline';
            document.getElementById('nav-signup').style.display = 'inline';
        }
    }

    function displayPastes() {
        const tbody = document.getElementById('pastesTableBody');
        const pasteCount = document.getElementById('pasteCount');
        
        if (!pastes || pastes.length === 0) {
            tbody.innerHTML = '<tr><td colspan="4" class="no-data">No pastes yet. Be the first to create one!</td></tr>';
            pasteCount.textContent = '0 total pastes';
            return;
        }

        // Only show pastes from users that still exist in the users array
        const validPastes = pastes.filter(paste => {
            return users.some(user => user.username === paste.createdBy);
        });

        if (validPastes.length === 0) {
            tbody.innerHTML = '<tr><td colspan="4" class="no-data">No pastes from existing users</td></tr>';
            pasteCount.textContent = '0 total pastes';
            return;
        }

        // Sort pastes by date (newest first)
        const sortedPastes = [...validPastes].sort((a, b) => {
            return new Date(b.added) - new Date(a.added);
        });

        tbody.innerHTML = '';
        sortedPastes.forEach(paste => {
            // Find the user to get their current role
            const user = users.find(u => u.username === paste.createdBy);
            const role = user ? user.role : 'User';
            
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${escapeHtml(paste.title)}</td>
                <td><span class="views">${paste.views || 0}</span></td>
                <td>${escapeHtml(paste.createdBy)} ${role !== 'User' ? `<span class="user-badge">[${escapeHtml(role)}]</span>` : ''}</td>
                <td>${escapeHtml(paste.added)}</td>
            `;
            tbody.appendChild(row);
        });

        pasteCount.textContent = `${validPastes.length} total pastes`;
    }

    function displayUsers() {
        const tbody = document.getElementById('usersTableBody');
        
        if (!users || users.length === 0) {
            tbody.innerHTML = '<tr><td colspan="4" class="no-data">No users registered yet. Sign up to be the first!</td></tr>';
            return;
        }

        tbody.innerHTML = '';

        // Sort users by join date (newest first)
        const sortedUsers = [...users].sort((a, b) => {
            return new Date(b.joined) - new Date(a.joined);
        });

        sortedUsers.forEach(user => {
            // Count only pastes that exist and belong to this user
            const userPastes = pastes.filter(p => p.createdBy === user.username).length;
            
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${escapeHtml(user.username)}</td>
                <td>${user.role && user.role !== 'User' ? `<span class="user-badge">[${escapeHtml(user.role)}]</span>` : ''}</td>
                <td>${userPastes}</td>
                <td>${escapeHtml(user.joined)}</td>
            `;
            tbody.appendChild(row);
        });
    }

    function filterPastes() {
        const searchTerm = document.getElementById('global-search').value.toLowerCase();
        const rows = document.querySelectorAll('#pastesTableBody tr');
        
        rows.forEach(row => {
            if (row.classList.contains('no-data')) return;
            const text = row.textContent.toLowerCase();
            if (text.includes(searchTerm) || searchTerm === '') {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });
    }

    function escapeHtml(unsafe) {
        if (!unsafe) return '';
        return String(unsafe)
            .replace(/&/g, "&amp;")
            .replace(/</g, "&lt;")
            .replace(/>/g, "&gt;")
            .replace(/"/g, "&quot;")
            .replace(/'/g, "&#039;");
    }

    // ========== AUTH FUNCTIONS ==========
    function login() {
        const username = document.getElementById('loginUsername').value.trim();
        const password = document.getElementById('loginPassword').value;
        const errorDiv = document.getElementById('loginError');

        if (!username || !password) {
            errorDiv.textContent = 'Username and password are required';
            return;
        }

        const user = users.find(u => u.username === username && u.password === password);
        
        if (user) {
            currentUser = { username: user.username, role: user.role };
            localStorage.setItem('kittybin_currentUser', JSON.stringify(currentUser));
            errorDiv.textContent = '';
            document.getElementById('loginUsername').value = '';
            document.getElementById('loginPassword').value = '';
            showPage('index');
            updateUserStatus();
            displayPastes();
        } else {
            errorDiv.textContent = 'Invalid username or password';
        }
    }

    function signup() {
        const username = document.getElementById('signupUsername').value.trim();
        const password = document.getElementById('signupPassword').value;
        const confirmPassword = document.getElementById('signupConfirmPassword').value;
        const errorDiv = document.getElementById('signupError');
        const successDiv = document.getElementById('signupSuccess');

        errorDiv.textContent = '';
        successDiv.textContent = '';

        if (!username || !password) {
            errorDiv.textContent = 'Username and password are required';
            return;
        }

        if (password.length < 3) {
            errorDiv.textContent = 'Password must be at least 3 characters';
            return;
        }

        if (password !== confirmPassword) {
            errorDiv.textContent = 'Passwords do not match';
            return;
        }

        if (users.some(u => u.username.toLowerCase() === username.toLowerCase())) {
            errorDiv.textContent = 'Username already exists';
            return;
        }

        // Format date as "Feb 27, 2026"
        const now = new Date();
        const month = now.toLocaleString('en-US', { month: 'short' });
        const day = now.getDate();
        const year = now.getFullYear();
        const joinedDate = `${month} ${day}, ${year}`;

        const newUser = {
            username: username,
            password: password,
            role: 'User',
            joined: joinedDate
        };

        users.push(newUser);
        saveUsers();
        
        successDiv.textContent = 'Account created successfully! You can now login.';
        
        // Clear form
        document.getElementById('signupUsername').value = '';
        document.getElementById('signupPassword').value = '';
        document.getElementById('signupConfirmPassword').value = '';
        
        // Update users display if on that page
        if (document.getElementById('page-users').classList.contains('active')) {
            displayUsers();
        }
    }

    function logout() {
        currentUser = null;
        localStorage.removeItem('kittybin_currentUser');
        updateUserStatus();
        showPage('index');
        displayPastes();
    }

    // ========== PASTE FUNCTIONS ==========
    function createPaste() {
        if (!currentUser) {
            alert('You must be logged in to create a paste');
            showPage('login');
            return;
        }

        const title = document.getElementById('pasteTitle').value.trim();
        const content = document.getElementById('pasteContent').value.trim();

        if (!title || !content) {
            alert('Title and content are required');
            return;
        }

        if (title.length > 100) {
            alert('Title must be less than 100 characters');
            return;
        }

        // Format date as "Feb 27, 2026"
        const now = new Date();
        const month = now.toLocaleString('en-US', { month: 'short' });
        const day = now.getDate();
        const year = now.getFullYear();
        const addedDate = `${month} ${day}, ${year}`;

        const newPaste = {
            title: title,
            content: content,
            views: 0,
            createdBy: currentUser.username,
            added: addedDate
        };

        pastes.push(newPaste);
        savePastes();
        
        clearPasteForm();
        displayPastes();
        alert('Paste created successfully!');
    }

    function clearPasteForm() {
        document.getElementById('pasteTitle').value = '';
        document.getElementById('pasteContent').value = '';
    }

    // ========== PAGE NAVIGATION ==========
    function showPage(pageId) {
        document.querySelectorAll('.page').forEach(page => {
            page.classList.remove('active');
        });
        
        document.getElementById(`page-${pageId}`).classList.add('active');
        
        document.querySelectorAll('.nav-links a').forEach(link => {
            link.classList.remove('active');
        });
        document.getElementById(`nav-${pageId}`).classList.add('active');

        // Refresh data when switching pages
        if (pageId === 'index') {
            displayPastes();
        } else if (pageId === 'users') {
            displayUsers();
        }

        // Clear search
        document.getElementById('global-search').value = '';
    }

    // ========== INITIALIZATION ==========
    window.onload = function() {
        // Clear everything on load to ensure no cached data
        users = [];
        pastes = [];
        currentUser = null;
        localStorage.removeItem('kittybin_users');
        localStorage.removeItem('kittybin_pastes');
        localStorage.removeItem('kittybin_currentUser');
        saveUsers();
        savePastes();
        
        updateUserStatus();
        displayPastes();
        displayUsers();
        showPage('index');
    };
</script>
</body>
</html>
